on:
  schedule:
    - cron: '0 0 * * 1'

name: Scheduled Release
jobs:
  release:
    name: Create Weekly Release
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:

    - name: Checkout repo
      uses: actions/checkout@v6
      with:
        fetch-depth: 0

    - name: Create weekly release
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        LATEST=$(gh release view --json tagName -q .tagName)
        CHANGES=$(git log "${LATEST}..HEAD" --oneline)
        if [ -z "$CHANGES" ]; then
          echo "No changes since ${LATEST}, skipping release."
          exit 0
        fi
        MAJOR=$(echo "$LATEST" | sed 's/^v//' | cut -d. -f1)
        MINOR=$(echo "$LATEST" | sed 's/^v//' | cut -d. -f2)
        PATCH=$(echo "$LATEST" | sed 's/^v//' | cut -d. -f3)
        TAG="v${MAJOR}.${MINOR}.$((PATCH + 1))"
        gh release create "$TAG" --title "$TAG" --generate-notes
